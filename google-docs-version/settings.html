<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
      background: #f9f9f9;
      padding: 24px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #E53935;
    }
    
    .header-title {
      color: #E53935;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .header-icon {
      font-size: 40px;
    }
    
    .setting-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .section-title {
      color: #333;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
    }
    
    .section-icon {
      margin-right: 8px;
      font-size: 20px;
    }
    
    .setting-item {
      margin-bottom: 16px;
    }
    
    .setting-label {
      display: block;
      color: #666;
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .setting-description {
      color: #999;
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.4;
    }
    
    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #E53935;
    }
    
    .checkbox-wrapper {
      display: flex;
      align-items: center;
    }
    
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      cursor: pointer;
    }
    
    .range-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    input[type="range"] {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: #ddd;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #E53935;
      cursor: pointer;
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #E53935;
      cursor: pointer;
      border: none;
    }
    
    .range-value {
      min-width: 40px;
      text-align: right;
      color: #E53935;
      font-weight: bold;
    }
    
    .theme-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .theme-option {
      padding: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .theme-option:hover {
      border-color: #E53935;
      transform: translateY(-2px);
    }
    
    .theme-option.selected {
      border-color: #E53935;
      background: #FFEBEE;
    }
    
    .theme-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }
    
    .theme-name {
      font-size: 13px;
      font-weight: bold;
      color: #333;
    }
    
    .btn-container {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-save {
      background: #E53935;
      color: white;
    }
    
    .btn-save:hover {
      background: #C62828;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(229, 57, 53, 0.4);
    }
    
    .btn-cancel {
      background: #f5f5f5;
      color: #666;
    }
    
    .btn-cancel:hover {
      background: #e0e0e0;
    }
    
    .ai-warning {
      background: #FFF3E0;
      border-left: 4px solid #FF9800;
      padding: 12px;
      margin-top: 8px;
      border-radius: 4px;
      font-size: 12px;
      color: #E65100;
      display: none;
    }
    
    .ai-warning.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-icon">âš™ï¸</div>
    <div class="header-title">ãƒ­ãƒ³ãƒªã¡ã‚ƒã‚“è¨­å®š</div>
  </div>
  
  <div class="setting-section">
    <div class="section-title">
      <span class="section-icon">ğŸ¨</span>
      ãƒ†ãƒ¼ãƒé¸æŠ
    </div>
    <div class="theme-options" id="themeOptions">
      <div class="theme-option selected" data-theme="logical_leap">
        <div class="theme-icon">ğŸª½</div>
        <div class="theme-name">è«–ç†ã®é£›èº</div>
      </div>
      <div class="theme-option" data-theme="too_polished">
        <div class="theme-icon">âš™ï¸</div>
        <div class="theme-name">æ•´ã„ã™ãè­¦å ±</div>
      </div>
    </div>
  </div>
  
  <div class="setting-section">
    <div class="section-title">
      <span class="section-icon">ğŸ²</span>
      æ¤œå‡ºè¨­å®š
    </div>
    
    <div class="setting-item">
      <label class="setting-label">ãƒ©ãƒ³ãƒ€ãƒ æ¤œå‡ºç‡</label>
      <div class="range-wrapper">
        <input type="range" id="randomRate" min="0" max="20" value="5" step="1">
        <span class="range-value" id="randomRateValue">5%</span>
      </div>
      <div class="setting-description">
        æ°—ã¾ãã‚Œã«é£›èºã‚’æ¤œå‡ºã™ã‚‹ç¢ºç‡ã§ã™ã€‚éŠã³å¿ƒã‚’æ¼”å‡ºã—ã¾ã™ã€‚
      </div>
    </div>
    
    <div class="setting-item">
      <div class="checkbox-wrapper">
        <input type="checkbox" id="enableSound" checked>
        <label class="setting-label" style="margin: 0;">åŠ¹æœéŸ³ã‚’å†ç”Ÿ</label>
      </div>
      <div class="setting-description">
        æŠ¼å°æ™‚ã®ã€Œãƒãƒ³ãƒƒã€ã¨ã„ã†åŠ¹æœéŸ³ã®ON/OFFã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
      </div>
    </div>
  </div>
  
  <div class="setting-section">
    <div class="section-title">
      <span class="section-icon">ğŸ¤–</span>
      AIè£œåŠ©æ¤œå‡ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    </div>
    
    <div class="setting-item">
      <div class="checkbox-wrapper">
        <input type="checkbox" id="enableAI">
        <label class="setting-label" style="margin: 0;">AIæ¤œå‡ºã‚’æœ‰åŠ¹åŒ–</label>
      </div>
      <div class="setting-description">
        GPT APIã‚’ä½¿ç”¨ã—ã¦ã€ã‚ˆã‚Šé«˜åº¦ãªæ–‡è„ˆåˆ†æã‚’è¡Œã„ã¾ã™ã€‚
      </div>
    </div>
    
    <div class="setting-item" id="aiKeySection" style="display: none;">
      <label class="setting-label">OpenAI API Key</label>
      <input type="text" id="aiApiKey" placeholder="sk-...">
      <div class="setting-description">
        OpenAIã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      </div>
      <div class="ai-warning" id="aiWarning">
        âš ï¸ APIã‚­ãƒ¼ã¯å®‰å…¨ã«ä¿ç®¡ã•ã‚Œã¾ã™ãŒã€ä½¿ç”¨ã«ã¯æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </div>
  </div>
  
  <div class="btn-container">
    <button class="btn btn-cancel" onclick="closeDialog()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="btn btn-save" onclick="saveSettings()">ä¿å­˜</button>
  </div>

  <script>
    let currentSettings = {};
    
    // è¨­å®šã‚’èª­ã¿è¾¼ã¿
    function loadSettings() {
      google.script.run
        .withSuccessHandler(displaySettings)
        .getSettings();
    }
    
    // è¨­å®šã‚’è¡¨ç¤º
    function displaySettings(settings) {
      currentSettings = settings;
      
      // ãƒ†ãƒ¼ãƒé¸æŠ
      document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === settings.theme) {
          option.classList.add('selected');
        }
      });
      
      // ãƒ©ãƒ³ãƒ€ãƒ æ¤œå‡ºç‡
      document.getElementById('randomRate').value = settings.randomRate || 5;
      document.getElementById('randomRateValue').textContent = (settings.randomRate || 5) + '%';
      
      // åŠ¹æœéŸ³
      document.getElementById('enableSound').checked = settings.enableSound !== false;
      
      // AIè¨­å®š
      document.getElementById('enableAI').checked = settings.enableAI || false;
      document.getElementById('aiApiKey').value = settings.aiApiKey || '';
      
      if (settings.enableAI) {
        document.getElementById('aiKeySection').style.display = 'block';
        document.getElementById('aiWarning').classList.add('show');
      }
    }
    
    // ãƒ†ãƒ¼ãƒé¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('selected'));
        this.classList.add('selected');
      });
    });
    
    // ãƒ©ãƒ³ãƒ€ãƒ æ¤œå‡ºç‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
    document.getElementById('randomRate').addEventListener('input', function() {
      document.getElementById('randomRateValue').textContent = this.value + '%';
    });
    
    // AIæœ‰åŠ¹åŒ–ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
    document.getElementById('enableAI').addEventListener('change', function() {
      const aiKeySection = document.getElementById('aiKeySection');
      const aiWarning = document.getElementById('aiWarning');
      
      if (this.checked) {
        aiKeySection.style.display = 'block';
        aiWarning.classList.add('show');
      } else {
        aiKeySection.style.display = 'none';
        aiWarning.classList.remove('show');
      }
    });
    
    // è¨­å®šã‚’ä¿å­˜
    function saveSettings() {
      const selectedTheme = document.querySelector('.theme-option.selected').dataset.theme;
      
      const settings = {
        theme: selectedTheme,
        randomRate: parseInt(document.getElementById('randomRate').value),
        enableSound: document.getElementById('enableSound').checked,
        enableAI: document.getElementById('enableAI').checked,
        aiApiKey: document.getElementById('aiApiKey').value
      };
      
      google.script.run
        .withSuccessHandler(onSaveSuccess)
        .withFailureHandler(onSaveError)
        .saveSettings(settings);
    }
    
    function onSaveSuccess() {
      alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
      closeDialog();
    }
    
    function onSaveError(error) {
      alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error);
    }
    
    // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
    function closeDialog() {
      google.script.host.close();
    }
    
    // åˆæœŸåŒ–
    loadSettings();
  </script>
</body>
</html>
